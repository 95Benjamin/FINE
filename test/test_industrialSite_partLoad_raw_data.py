#!/usr/bin/env python
# coding: utf-8

import FINE as fn         # Provides objects and functions to model an energy system 
import pandas as pd       # Used to manage data in tables
import numpy as np        # Used to generate random input data


def test_industrialSite():
    # # Model an energy system

    # Input parameters
    locations = {'industry_0'}
    commodityUnitDict = {'electricity': r'MW$_{el}$', 'hydrogen': r'MW$_{H_{2},LHV}$'}
    commodities = {'electricity', 'hydrogen'}
    numberOfTimeSteps, hoursPerTimeStep = 24*6, 1/6 #8760, 1 # 52560, 1/6
    costUnit, lengthUnit = '1e3 Euro', 'km'

    # Code
    esM = fn.EnergySystemModel(locations=locations, commodities=commodities,
        numberOfTimeSteps=numberOfTimeSteps, commodityUnitsDict=commodityUnitDict,
        hoursPerTimeStep=hoursPerTimeStep, costUnit=costUnit, lengthUnit=lengthUnit, verboseLogLevel=0)


    # ## Add source component

    data = pd.read_excel('test/generationTimeSeries_e825103.xlsx')
    data = data.iloc[0:numberOfTimeSteps]

    # operationRateMax = pd.DataFrame(data['e825103_2017_2.3MW_faults9'],index=range(numberOfTimeSteps)) # Dataset with least missing data
    # operationRateMax.columns = ['industry_0']

    operationRateFix = pd.DataFrame(data['e825103_2017_2.3MW_faults9'],index=range(numberOfTimeSteps)) # Dataset with least missing data
    operationRateFix.columns = ['industry_0']

    # Input parameters
    name, commodity ='Wind turbines', 'electricity'
    hasCapacityVariable = True
    capacityMax = pd.Series([10], index=['industry_0']) # 10 MW_el = 0.01 GW_el
    investPerCapacity, opexPerCapacity = 0, 30 # 30 €/kW = 30 1e6€/GW = 30 1e3€/MW
    interestRate, economicLifetime = 0.08, 20

    # Code
    # esM.add(fn.Source(esM=esM, name=name, commodity=commodity, hasCapacityVariable=hasCapacityVariable,
    #     operationRateMax=operationRateMax, capacityFix=capacityFix, investPerCapacity=investPerCapacity,
    #     opexPerCapacity=opexPerCapacity, interestRate=interestRate, economicLifetime=economicLifetime))

    esM.add(fn.Source(esM=esM, name=name, commodity=commodity, hasCapacityVariable=hasCapacityVariable,
        operationRateFix=operationRateFix, capacityMax=capacityMax, investPerCapacity=investPerCapacity,
        opexPerCapacity=opexPerCapacity, interestRate=interestRate, economicLifetime=economicLifetime))

    # ## Add conversion components

    esM.add(fn.Conversion(esM=esM, name='PEMEC', physicalUnit=r'MW$_{el}$',
                        commodityConversionFactors={'electricity':-1, 'hydrogen':0.67},
                        hasCapacityVariable=True, 
                        investPerCapacity=2300, opexPerCapacity=12.5, interestRate=0.08, # for 2018 CAPEX
                        economicLifetime=5))

    # AEC with constant commodityConversionFactors
    # esM.add(fn.Conversion(esM=esM, name='AEC', physicalUnit=r'MW$_{el}$',
    #                       commodityConversionFactors={'electricity':-1, 'hydrogen':0.64},
    #                       hasCapacityVariable=True, 
    #                       investPerCapacity=1300, opexPerCapacity=18, interestRate=0.08, # for 2018 CAPEX
    #                       economicLifetime=9))

    # AEC with raw data for commodityConversionFactors
    #TODO: read csv
    x = [0.0960960960960961, 0.0970970970970971, 0.0980980980980981, 0.0990990990990991, 0.10010010010010009, 0.1011011011011011, 0.1021021021021021, 0.1031031031031031, 0.1041041041041041, 0.10510510510510511, 0.1061061061061061, 0.10710710710710711, 0.10810810810810811, 0.1091091091091091, 0.11011011011011011, 0.1111111111111111, 0.11211211211211211, 0.11311311311311312, 0.11411411411411411, 0.11511511511511512, 0.11611611611611611, 0.11711711711711711, 0.11811811811811812, 0.11911911911911911, 0.12012012012012012, 0.12112112112112113, 0.12212212212212212, 0.12312312312312312, 0.12412412412412413, 0.12512512512512514, 0.12612612612612611, 0.12712712712712712, 0.12812812812812813, 0.12912912912912913, 0.13013013013013014, 0.13113113113113112, 0.13213213213213212, 0.13313313313313313, 0.13413413413413414, 0.13513513513513514, 0.13613613613613612, 0.13713713713713713, 0.13813813813813813, 0.13913913913913914, 0.14014014014014015, 0.14114114114114115, 0.14214214214214213, 0.14314314314314314, 0.14414414414414414, 0.14514514514514515, 0.14614614614614616, 0.14714714714714713, 0.14814814814814814, 0.14914914914914915, 0.15015015015015015, 0.15115115115115116, 0.15215215215215216, 0.15315315315315314, 0.15415415415415415, 0.15515515515515516, 0.15615615615615616, 0.15715715715715717, 0.15815815815815815, 0.15915915915915915, 0.16016016016016016, 0.16116116116116116, 0.16216216216216217, 0.16316316316316315, 0.16416416416416416, 0.16516516516516516, 0.16616616616616617, 0.16716716716716717, 0.16816816816816815, 0.16916916916916916, 0.17017017017017017, 0.17117117117117117, 0.17217217217217218, 0.17317317317317318, 0.17417417417417416, 0.17517517517517517, 0.17617617617617617, 0.17717717717717718, 0.1781781781781782, 0.17917917917917917, 0.18018018018018017, 0.18118118118118118, 0.18218218218218218, 0.1831831831831832, 0.1841841841841842, 0.18518518518518517, 0.18618618618618618, 0.1871871871871872, 0.1881881881881882, 0.1891891891891892, 0.19019019019019018, 0.19119119119119118, 0.1921921921921922, 0.1931931931931932, 0.1941941941941942, 0.19519519519519518, 0.1961961961961962, 0.1971971971971972, 0.1981981981981982, 0.1991991991991992, 0.20020020020020018, 0.2012012012012012, 0.2022022022022022, 0.2032032032032032, 0.2042042042042042, 0.20520520520520522, 0.2062062062062062, 0.2072072072072072, 0.2082082082082082, 0.2092092092092092, 0.21021021021021022, 0.2112112112112112, 0.2122122122122122, 0.2132132132132132, 0.21421421421421422, 0.21521521521521522, 0.21621621621621623, 0.2172172172172172, 0.2182182182182182, 0.21921921921921922, 0.22022022022022023, 0.22122122122122123, 0.2222222222222222, 0.22322322322322322, 0.22422422422422422, 0.22522522522522523, 0.22622622622622623, 0.2272272272272272, 0.22822822822822822, 0.22922922922922923, 0.23023023023023023, 0.23123123123123124, 0.23223223223223222, 0.23323323323323322, 0.23423423423423423, 0.23523523523523523, 0.23623623623623624, 0.23723723723723725, 0.23823823823823823, 0.23923923923923923, 0.24024024024024024, 0.24124124124124124, 0.24224224224224225, 0.24324324324324323, 0.24424424424424424, 0.24524524524524524, 0.24624624624624625, 0.24724724724724725, 0.24824824824824826, 0.24924924924924924, 0.2502502502502503, 0.25125125125125125, 0.25225225225225223, 0.25325325325325326, 0.25425425425425424, 0.2552552552552553, 0.25625625625625625, 0.25725725725725723, 0.25825825825825827, 0.25925925925925924, 0.2602602602602603, 0.26126126126126126, 0.26226226226226224, 0.26326326326326327, 0.26426426426426425, 0.2652652652652653, 0.26626626626626626, 0.26726726726726724, 0.2682682682682683, 0.26926926926926925, 0.2702702702702703, 0.27127127127127126, 0.27227227227227224, 0.2732732732732733, 0.27427427427427425, 0.2752752752752753, 0.27627627627627627, 0.2772772772772773, 0.2782782782782783, 0.27927927927927926, 0.2802802802802803, 0.28128128128128127, 0.2822822822822823, 0.2832832832832833, 0.28428428428428426, 0.2852852852852853, 0.2862862862862863, 0.2872872872872873, 0.2882882882882883, 0.28928928928928926, 0.2902902902902903, 0.2912912912912913, 0.2922922922922923, 0.2932932932932933, 0.29429429429429427, 0.2952952952952953, 0.2962962962962963, 0.2972972972972973, 0.2982982982982983, 0.29929929929929927, 0.3003003003003003, 0.3013013013013013, 0.3023023023023023, 0.3033033033033033, 0.30430430430430433, 0.3053053053053053, 0.3063063063063063, 0.3073073073073073, 0.3083083083083083, 0.30930930930930933, 0.3103103103103103, 0.3113113113113113, 0.3123123123123123, 0.3133133133133133, 0.31431431431431434, 0.3153153153153153, 0.3163163163163163, 0.3173173173173173, 0.3183183183183183, 0.31931931931931934, 0.3203203203203203, 0.3213213213213213, 0.32232232232232233, 0.3233233233233233, 0.32432432432432434, 0.3253253253253253, 0.3263263263263263, 0.32732732732732733, 0.3283283283283283, 0.32932932932932935, 0.3303303303303303, 0.3313313313313313, 0.33233233233233234, 0.3333333333333333, 0.33433433433433435, 0.3353353353353353, 0.3363363363363363, 0.33733733733733734, 0.3383383383383383, 0.33933933933933935, 0.34034034034034033, 0.34134134134134136, 0.34234234234234234, 0.3433433433433433, 0.34434434434434436, 0.34534534534534533, 0.34634634634634637, 0.34734734734734735, 0.3483483483483483, 0.34934934934934936, 0.35035035035035034, 0.35135135135135137, 0.35235235235235235, 0.3533533533533533, 0.35435435435435436, 0.35535535535535534, 0.3563563563563564, 0.35735735735735735, 0.35835835835835833, 0.35935935935935936, 0.36036036036036034, 0.3613613613613614, 0.36236236236236236, 0.36336336336336333, 0.36436436436436437, 0.36536536536536535, 0.3663663663663664, 0.36736736736736736, 0.3683683683683684, 0.36936936936936937, 0.37037037037037035, 0.3713713713713714, 0.37237237237237236, 0.3733733733733734, 0.3743743743743744, 0.37537537537537535, 0.3763763763763764, 0.37737737737737737, 0.3783783783783784, 0.3793793793793794, 0.38038038038038036, 0.3813813813813814, 0.38238238238238237, 0.3833833833833834, 0.3843843843843844, 0.38538538538538536, 0.3863863863863864, 0.38738738738738737, 0.3883883883883884, 0.3893893893893894, 0.39039039039039036, 0.3913913913913914, 0.3923923923923924, 0.3933933933933934, 0.3943943943943944, 0.39539539539539537, 0.3963963963963964, 0.3973973973973974, 0.3983983983983984, 0.3993993993993994, 0.40040040040040037, 0.4014014014014014, 0.4024024024024024, 0.4034034034034034, 0.4044044044044044, 0.40540540540540543, 0.4064064064064064, 0.4074074074074074, 0.4084084084084084, 0.4094094094094094, 0.41041041041041043, 0.4114114114114114, 0.4124124124124124, 0.4134134134134134, 0.4144144144144144, 0.41541541541541543, 0.4164164164164164, 0.4174174174174174, 0.4184184184184184, 0.4194194194194194, 0.42042042042042044, 0.4214214214214214, 0.4224224224224224, 0.42342342342342343, 0.4244244244244244, 0.42542542542542544, 0.4264264264264264, 0.4274274274274274, 0.42842842842842843, 0.4294294294294294, 0.43043043043043044, 0.4314314314314314, 0.43243243243243246, 0.43343343343343343, 0.4344344344344344, 0.43543543543543545, 0.4364364364364364, 0.43743743743743746, 0.43843843843843844, 0.4394394394394394, 0.44044044044044045, 0.44144144144144143, 0.44244244244244246, 0.44344344344344344, 0.4444444444444444, 0.44544544544544545, 0.44644644644644643, 0.44744744744744747, 0.44844844844844844, 0.4494494494494494, 0.45045045045045046, 0.45145145145145144, 0.45245245245245247, 0.45345345345345345, 0.4544544544544544, 0.45545545545545546, 0.45645645645645644, 0.4574574574574575, 0.45845845845845845, 0.45945945945945943, 0.46046046046046046, 0.46146146146146144, 0.4624624624624625, 0.46346346346346345, 0.46446446446446443, 0.46546546546546547, 0.46646646646646645, 0.4674674674674675, 0.46846846846846846, 0.4694694694694695, 0.47047047047047047, 0.47147147147147145, 0.4724724724724725, 0.47347347347347346, 0.4744744744744745, 0.4754754754754755, 0.47647647647647645, 0.4774774774774775, 0.47847847847847846, 0.4794794794794795, 0.4804804804804805, 0.48148148148148145, 0.4824824824824825, 0.48348348348348347, 0.4844844844844845, 0.4854854854854855, 0.48648648648648646, 0.4874874874874875, 0.48848848848848847, 0.4894894894894895, 0.4904904904904905, 0.49149149149149146, 0.4924924924924925, 0.4934934934934935, 0.4944944944944945, 0.4954954954954955, 0.4964964964964965, 0.4974974974974975, 0.4984984984984985, 0.4994994994994995, 0.5005005005005005, 0.5015015015015015, 0.5025025025025025, 0.5035035035035035, 0.5045045045045045, 0.5055055055055055, 0.5065065065065065, 0.5075075075075075, 0.5085085085085085, 0.5095095095095095, 0.5105105105105106, 0.5115115115115115, 0.5125125125125125, 0.5135135135135135, 0.5145145145145145, 0.5155155155155156, 0.5165165165165165, 0.5175175175175175, 0.5185185185185185, 0.5195195195195195, 0.5205205205205206, 0.5215215215215215, 0.5225225225225225, 0.5235235235235235, 0.5245245245245245, 0.5255255255255256, 0.5265265265265265, 0.5275275275275275, 0.5285285285285285, 0.5295295295295295, 0.5305305305305306, 0.5315315315315315, 0.5325325325325325, 0.5335335335335335, 0.5345345345345345, 0.5355355355355356, 0.5365365365365365, 0.5375375375375375, 0.5385385385385385, 0.5395395395395395, 0.5405405405405406, 0.5415415415415415, 0.5425425425425425, 0.5435435435435435, 0.5445445445445445, 0.5455455455455456, 0.5465465465465466, 0.5475475475475475, 0.5485485485485485, 0.5495495495495496, 0.5505505505505506, 0.5515515515515516, 0.5525525525525525, 0.5535535535535535, 0.5545545545545546, 0.5555555555555556, 0.5565565565565566, 0.5575575575575575, 0.5585585585585585, 0.5595595595595596, 0.5605605605605606, 0.5615615615615616, 0.5625625625625625, 0.5635635635635635, 0.5645645645645646, 0.5655655655655656, 0.5665665665665666, 0.5675675675675675, 0.5685685685685685, 0.5695695695695696, 0.5705705705705706, 0.5715715715715716, 0.5725725725725725, 0.5735735735735735, 0.5745745745745746, 0.5755755755755756, 0.5765765765765766, 0.5775775775775776, 0.5785785785785785, 0.5795795795795796, 0.5805805805805806, 0.5815815815815816, 0.5825825825825826, 0.5835835835835835, 0.5845845845845846, 0.5855855855855856, 0.5865865865865866, 0.5875875875875876, 0.5885885885885885, 0.5895895895895896, 0.5905905905905906, 0.5915915915915916, 0.5925925925925926, 0.5935935935935935, 0.5945945945945946, 0.5955955955955956, 0.5965965965965966, 0.5975975975975976, 0.5985985985985985, 0.5995995995995996, 0.6006006006006006, 0.6016016016016016, 0.6026026026026026, 0.6036036036036035, 0.6046046046046046, 0.6056056056056056, 0.6066066066066066, 0.6076076076076076, 0.6086086086086087, 0.6096096096096096, 0.6106106106106106, 0.6116116116116116, 0.6126126126126126, 0.6136136136136137, 0.6146146146146146, 0.6156156156156156, 0.6166166166166166, 0.6176176176176176, 0.6186186186186187, 0.6196196196196196, 0.6206206206206206, 0.6216216216216216, 0.6226226226226226, 0.6236236236236237, 0.6246246246246246, 0.6256256256256256, 0.6266266266266266, 0.6276276276276276, 0.6286286286286287, 0.6296296296296297, 0.6306306306306306, 0.6316316316316316, 0.6326326326326326, 0.6336336336336337, 0.6346346346346347, 0.6356356356356356, 0.6366366366366366, 0.6376376376376376, 0.6386386386386387, 0.6396396396396397, 0.6406406406406406, 0.6416416416416416, 0.6426426426426426, 0.6436436436436437, 0.6446446446446447, 0.6456456456456456, 0.6466466466466466, 0.6476476476476476, 0.6486486486486487, 0.6496496496496497, 0.6506506506506506, 0.6516516516516516, 0.6526526526526526, 0.6536536536536537, 0.6546546546546547, 0.6556556556556556, 0.6566566566566566, 0.6576576576576576, 0.6586586586586587, 0.6596596596596597, 0.6606606606606606, 0.6616616616616616, 0.6626626626626626, 0.6636636636636637, 0.6646646646646647, 0.6656656656656657, 0.6666666666666666, 0.6676676676676676, 0.6686686686686687, 0.6696696696696697, 0.6706706706706707, 0.6716716716716716, 0.6726726726726726, 0.6736736736736737, 0.6746746746746747, 0.6756756756756757, 0.6766766766766766, 0.6776776776776777, 0.6786786786786787, 0.6796796796796797, 0.6806806806806807, 0.6816816816816816, 0.6826826826826827, 0.6836836836836837, 0.6846846846846847, 0.6856856856856857, 0.6866866866866866, 0.6876876876876877, 0.6886886886886887, 0.6896896896896897, 0.6906906906906907, 0.6916916916916916, 0.6926926926926927, 0.6936936936936937, 0.6946946946946947, 0.6956956956956957, 0.6966966966966966, 0.6976976976976977, 0.6986986986986987, 0.6996996996996997, 0.7007007007007007, 0.7017017017017017, 0.7027027027027027, 0.7037037037037037, 0.7047047047047047, 0.7057057057057057, 0.7067067067067067, 0.7077077077077077, 0.7087087087087087, 0.7097097097097097, 0.7107107107107107, 0.7117117117117117, 0.7127127127127127, 0.7137137137137137, 0.7147147147147147, 0.7157157157157157, 0.7167167167167167, 0.7177177177177178, 0.7187187187187187, 0.7197197197197197, 0.7207207207207207, 0.7217217217217217, 0.7227227227227228, 0.7237237237237237, 0.7247247247247247, 0.7257257257257257, 0.7267267267267267, 0.7277277277277278, 0.7287287287287287, 0.7297297297297297, 0.7307307307307307, 0.7317317317317317, 0.7327327327327328, 0.7337337337337337, 0.7347347347347347, 0.7357357357357357, 0.7367367367367368, 0.7377377377377378, 0.7387387387387387, 0.7397397397397397, 0.7407407407407407, 0.7417417417417418, 0.7427427427427428, 0.7437437437437437, 0.7447447447447447, 0.7457457457457457, 0.7467467467467468, 0.7477477477477478, 0.7487487487487487, 0.7497497497497497, 0.7507507507507507, 0.7517517517517518, 0.7527527527527528, 0.7537537537537538, 0.7547547547547547, 0.7557557557557557, 0.7567567567567568, 0.7577577577577578, 0.7587587587587588, 0.7597597597597597, 0.7607607607607607, 0.7617617617617618, 0.7627627627627628, 0.7637637637637638, 0.7647647647647647, 0.7657657657657657, 0.7667667667667668, 0.7677677677677678, 0.7687687687687688, 0.7697697697697697, 0.7707707707707707, 0.7717717717717718, 0.7727727727727728, 0.7737737737737738, 0.7747747747747747, 0.7757757757757757, 0.7767767767767768, 0.7777777777777778, 0.7787787787787788, 0.7797797797797797, 0.7807807807807807, 0.7817817817817818, 0.7827827827827828, 0.7837837837837838, 0.7847847847847848, 0.7857857857857857, 0.7867867867867868, 0.7877877877877878, 0.7887887887887888, 0.7897897897897898, 0.7907907907907907, 0.7917917917917918, 0.7927927927927928, 0.7937937937937938, 0.7947947947947948, 0.7957957957957957, 0.7967967967967968, 0.7977977977977978, 0.7987987987987988, 0.7997997997997998, 0.8008008008008007, 0.8018018018018018, 0.8028028028028028, 0.8038038038038038, 0.8048048048048048, 0.8058058058058059, 0.8068068068068068, 0.8078078078078078, 0.8088088088088088, 0.8098098098098098, 0.8108108108108109, 0.8118118118118118, 0.8128128128128128, 0.8138138138138138, 0.8148148148148148, 0.8158158158158159, 0.8168168168168168, 0.8178178178178178, 0.8188188188188188, 0.8198198198198198, 0.8208208208208209, 0.8218218218218218, 0.8228228228228228, 0.8238238238238238, 0.8248248248248248, 0.8258258258258259, 0.8268268268268268, 0.8278278278278278, 0.8288288288288288, 0.8298298298298298, 0.8308308308308309, 0.8318318318318318, 0.8328328328328328, 0.8338338338338338, 0.8348348348348348, 0.8358358358358359, 0.8368368368368369, 0.8378378378378378, 0.8388388388388388, 0.8398398398398398, 0.8408408408408409, 0.8418418418418419, 0.8428428428428428, 0.8438438438438438, 0.8448448448448448, 0.8458458458458459, 0.8468468468468469, 0.8478478478478478, 0.8488488488488488, 0.8498498498498498, 0.8508508508508509, 0.8518518518518519, 0.8528528528528528, 0.8538538538538538, 0.8548548548548548, 0.8558558558558559, 0.8568568568568569, 0.8578578578578578, 0.8588588588588588, 0.8598598598598598, 0.8608608608608609, 0.8618618618618619, 0.8628628628628628, 0.8638638638638638, 0.8648648648648649, 0.8658658658658659, 0.8668668668668669, 0.8678678678678678, 0.8688688688688688, 0.8698698698698699, 0.8708708708708709, 0.8718718718718719, 0.8728728728728729, 0.8738738738738738, 0.8748748748748749, 0.8758758758758759, 0.8768768768768769, 0.8778778778778779, 0.8788788788788788, 0.8798798798798799, 0.8808808808808809, 0.8818818818818819, 0.8828828828828829, 0.8838838838838838, 0.8848848848848849, 0.8858858858858859, 0.8868868868868869, 0.8878878878878879, 0.8888888888888888, 0.8898898898898899, 0.8908908908908909, 0.8918918918918919, 0.8928928928928929, 0.8938938938938938, 0.8948948948948949, 0.8958958958958959, 0.8968968968968969, 0.8978978978978979, 0.8988988988988988, 0.8998998998998999, 0.9009009009009009]
    y = [0.1822760359620541, 0.18388672469780554, 0.18549371234138068, 0.18709700190179657, 0.18869659638807157, 0.1902924988092236, 0.19188471217427105, 0.19347323949223139, 0.19505808377212297, 0.19663924802296373, 0.19821673525377248, 0.1997905484735658, 0.20136069069136253, 0.202927164916181, 0.2044899741570383, 0.20604912142295362, 0.20760460972294403, 0.20915644206602835, 0.21070462146122404, 0.21224915091754903, 0.21379003344402214, 0.21532727204965996, 0.21686086974348218, 0.21839082953450584, 0.2199171544317493, 0.2214398474442305, 0.22295891158096692, 0.2244743498509778, 0.22598616526328064, 0.22749436082689245, 0.22899893955083295, 0.23049990444411872, 0.23199725851576902, 0.2334910047748009, 0.23498114623023314, 0.23646768589108325, 0.23795062676636913, 0.23942997186510961, 0.24090572419632217, 0.24237788676902428, 0.24384646259223564, 0.24531145467497195, 0.2467728660262538, 0.24823069965509692, 0.24968495857052053, 0.251135645781543, 0.2525827642971814, 0.2540263171264545, 0.2554663072783798, 0.25690273776197525, 0.2583356115862596, 0.2597649317602504, 0.2611907012929655, 0.2626129231934238, 0.2640316004706422, 0.2654467361336392, 0.26685833319143315, 0.2682663946530415, 0.269670923527483, 0.2710719228237748, 0.27246939555093563, 0.27386334471798346, 0.2752537733339353, 0.27664068440781087, 0.2780240809486272, 0.2794039659654026, 0.28078034246715466, 0.2821532134629017, 0.283522581961662, 0.28488845097245274, 0.2862508235042931, 0.28760970256620055, 0.28896509116719304, 0.2903169923162894, 0.2916654090225057, 0.29301034429486217, 0.2943518011423758, 0.2956897825740641, 0.2970242915989463, 0.2983553312260394, 0.29968290446436274, 0.30100701432293286, 0.3023276638107686, 0.30364485593688784, 0.3049585937103081, 0.3062688801400486, 0.3075757182351264, 0.3088791110045599, 0.3101790614573665, 0.31147557260256553, 0.312768647449174, 0.3140582890062098, 0.3153445002826918, 0.3166272842876374, 0.31790664403006463, 0.3191825825189918, 0.32045510276343725, 0.32172420777241806, 0.32298990055495347, 0.32425218412005963, 0.3255110614767567, 0.3267665356340621, 0.3280186096009925, 0.329267286386568, 0.3305125689998052, 0.33175446044972245, 0.33299296374533816, 0.3342280818956693, 0.3354598179097352, 0.33668817479655333, 0.337913155565142, 0.33913476322451874, 0.34035300078370145, 0.34156787125170895, 0.34277937763755917, 0.3439875229502696, 0.34519231019885854, 0.34639374239234355, 0.3475918225397434, 0.34878655365007605, 0.34997793873235894, 0.3511659807956109, 0.35235068284884896, 0.3535320479010915, 0.3547100789613573, 0.3558847790386639, 0.35705615114202915, 0.3582241982804706, 0.3593889234630079, 0.3605503296986572, 0.36170841999643777, 0.3628631973653671, 0.36401466481446354, 0.365162825352745, 0.36630768198922947, 0.3674492377329348, 0.3685874955928794, 0.3697224585780807, 0.37085412969755804, 0.37198251196032794, 0.3731076083754088, 0.37422942195181896, 0.3753479556985764, 0.3764632126246994, 0.3775751957392055, 0.37868390805111307, 0.37978935256944, 0.38089153230320427, 0.3819904502614242, 0.38308610945311683, 0.38417851288730187, 0.38526766357299636, 0.38635356451921776, 0.3874362187349849, 0.3885156292293157, 0.38959179901122853, 0.39066473108974087, 0.39173442847387063, 0.3928008941726362, 0.3938641311950555, 0.3949241425501473, 0.39598093124692824, 0.39703450029441667, 0.3980848527016314, 0.39913199147758993, 0.4001759196313106, 0.4012166401718118, 0.4022541561081101, 0.4032884704492248, 0.40431958620417374, 0.4053475063819745, 0.40637223399164535, 0.4073937720422043, 0.4084121235426692, 0.4094272915020589, 0.41043927892939047, 0.41144808883368267, 0.41245372422395254, 0.41345618810921936, 0.4144554834985006, 0.4154516134008137, 0.416444580825178, 0.41743438878060957, 0.4184210402761286, 0.41940453832075164, 0.420384885923498, 0.42136208609338377, 0.4223361418394287, 0.4233070561706507, 0.42427483209606676, 0.42523947262469575, 0.42620098076555557, 0.4271593595276637, 0.42811461192003897, 0.42906674095169883, 0.43001574963166167, 0.43096164096894585, 0.43190441797256796, 0.4328440836515477, 0.43378064101490255, 0.43471409307165, 0.4356444428308084, 0.43657169330139567, 0.43749584749243065, 0.43841690841293035, 0.4393348790719136, 0.4402497624783974, 0.44116156164140063, 0.4420702795699416, 0.44297591927303737, 0.4438784837597063, 0.44477797603896674, 0.4456743991198362, 0.4465677560113339, 0.4474580497224765, 0.4483452832622823, 0.4492294596397697, 0.4501105818639566, 0.45098865294386137, 0.4518636758885015, 0.4527356537068954, 0.4536045894080605, 0.45447048600101514, 0.4553333464947782, 0.4561931738983662, 0.45704997122079893, 0.4579037414710925, 0.4587544876582661, 0.4596022127913377, 0.4604469198793253, 0.4612886119312467, 0.4621272919561199, 0.4629629629629628, 0.4637956279607942, 0.46462528995863117, 0.4654519519654925, 0.4662756169903961, 0.4670962880423595, 0.46791396813040054, 0.4687286602635381, 0.46954036745079053, 0.4703490927011744, 0.4711548390237086, 0.4719576094274114, 0.4727574069213003, 0.4735542345143937, 0.47434809521571, 0.4751389920342657, 0.4759269279790801, 0.47671190605917113, 0.4774939292835567, 0.4782730006612548, 0.4790491232012837, 0.47982229991266045, 0.48059253380440436, 0.4813598278855329, 0.48212418516506395, 0.4828856086520159, 0.48364410135540625, 0.4843996662842538, 0.485152306447576, 0.4859020248543908, 0.48664882451371616, 0.48739270843457083, 0.48813367962597276, 0.4888717410969394, 0.4896068958564892, 0.49033914691363956, 0.49106849727740887, 0.4917949499568155, 0.49251850796087737, 0.49323917429861197, 0.4939569519790381, 0.49467184401117326, 0.4953838534040358, 0.49609298316664363, 0.4967992363080147, 0.4975026158371665, 0.49820312476311823, 0.498900766094887, 0.49959554284149155, 0.5002874580119494, 0.5009765146152785, 0.5016627156604971, 0.5023460641566233, 0.5030265631126754, 0.5037042155376708, 0.5043790244406274, 0.5050509928305642, 0.5057201237164985, 0.5063864201074484, 0.5070498850124321, 0.5077105214404676, 0.5083683324005728, 0.509023320901766, 0.5096754899530649, 0.5103248425634876, 0.5109713817420523, 0.5116151104977766, 0.5122560318396796, 0.5128941487767782, 0.5135294643180908, 0.5141619814726357, 0.51479170324943, 0.5154186326574934, 0.5160427727058421, 0.5166641264034957, 0.5172826967594708, 0.5178984867827867, 0.5185114994824604, 0.5191217378675108, 0.5197292049469553, 0.520333903729812, 0.5209358372250994, 0.5215350084418353, 0.5221314203890375, 0.5227250760757238, 0.5233159785109134, 0.523904130703623, 0.5244895356628712, 0.5250721963976761, 0.5256521159170555, 0.5262292972300275, 0.5268037433456105, 0.527375457272822, 0.5279444420206805, 0.5285107005982035, 0.5290742360144096, 0.5296350512783163, 0.5301931493989416, 0.5307485333853041, 0.531301206246422, 0.5318511709913123, 0.5323984306289935, 0.532942988168484, 0.5334848466188014, 0.5340240089889641, 0.5345604782879896, 0.5350942575248965, 0.5356253497087025, 0.5361537578484252, 0.536679484953084, 0.5372025340316955, 0.5377229080932784, 0.5382406101468509, 0.5387556432014302, 0.5392680102660354, 0.5397777143496838, 0.5402847584613937, 0.540789145610183, 0.5412908788050699, 0.5417899610550723, 0.5422863953692081, 0.5427801847564953, 0.5432713322259524, 0.5437598407865973, 0.5442457134474479, 0.5447289532175217, 0.5452095631058378, 0.5456875461214137, 0.5461629052732668, 0.5466356435704163, 0.5471057640218793, 0.5475732696366742, 0.5480381634238192, 0.5485004483923321, 0.5489601275512312, 0.549417203909534, 0.5498716804762589, 0.550323560260424, 0.5507728462710473, 0.5512195415171466, 0.5516636490077398, 0.5521051717518455, 0.5525441127584811, 0.5529804750366654, 0.5534142615954156, 0.5538454754437505, 0.5542741195906875, 0.554700197045245, 0.5551237108164404, 0.5555446639132928, 0.5559630593448195, 0.5563789001200385, 0.5567921892479681, 0.5572029297376264, 0.5576111245980313, 0.558016776838201, 0.5584198894671528, 0.558820465493906, 0.5592185079274772, 0.5596140197768853, 0.5600070040511482, 0.5603974637592841, 0.5607854019103109, 0.5611708215132458, 0.5615537255771084, 0.5619341171109156, 0.5623119991236858, 0.562687374624437, 0.563060246622187, 0.5634306181259541, 0.5637984921447563, 0.5641638716876118, 0.5645267597635382, 0.5648871593815536, 0.5652450735506762, 0.5656005052799244, 0.5659534575783158, 0.5663039334548681, 0.5666519359186, 0.566997467978529, 0.5673405326436736, 0.5676811329230513, 0.5680192718256807, 0.5683549523605795, 0.5686881775367658, 0.5690189503632574, 0.5693472738490732, 0.56967315100323, 0.5699965848347464, 0.5703175783526404, 0.5706361345659303, 0.5709522564836336, 0.571265947114769, 0.5715772094683538, 0.5718860465534068, 0.5721924613789453, 0.5724964569539874, 0.5727980362875518, 0.573097202388656, 0.5733939582663181, 0.5736883069295562, 0.5739802513873882, 0.5742697946488322, 0.5745569397229062, 0.5748416896186288, 0.575124047345017, 0.5754040159110898, 0.5756815983258643, 0.5759567975983588, 0.5762296167375922, 0.5765000587525817, 0.576768126652345, 0.5770338234459012, 0.5772971521422676, 0.5775581157504626, 0.5778167172795035, 0.5780729597384089, 0.5783268461361972, 0.5785783794818857, 0.5788275627844928, 0.5790743990530363, 0.5793188912965346, 0.5795610425240054, 0.5798008557444669, 0.5800383339669375, 0.5802734802004341, 0.5805062974539761, 0.5807367887365804, 0.5809649570572655, 0.5811908054250496, 0.5814143368489506, 0.5816355543379863, 0.5818544609011753, 0.5820710595475351, 0.5822853532860839, 0.5824973451258395, 0.5827070380758204, 0.5829144351450444, 0.583119539342529, 0.5833223536772931, 0.5835228811583546, 0.5837211247947309, 0.5839170875954407, 0.5841107725695014, 0.5843021827259318, 0.5844913210737495, 0.584678190621972, 0.5848627943796185, 0.5850451353557065, 0.5852252165592531, 0.5854030409992781, 0.5855786116847979, 0.5857519316248314, 0.5859230038283967, 0.5860918313045116, 0.5862584170621938, 0.5864227641104618, 0.5865848754583336, 0.586744754114827, 0.58690240308896, 0.5870578253897509, 0.5872110240262176, 0.5873620020073782, 0.5875107623422504, 0.5876573080398528, 0.5878016421092029, 0.5879437675593191, 0.5880836873992192, 0.5882214046379213, 0.5883569222844434, 0.5884902433478036, 0.58862137083702, 0.5887503077611105, 0.5888770571290929, 0.5890016219499858, 0.5891240052328068, 0.589244209986574, 0.5893622392203055, 0.5894780959430195, 0.5895917831637334, 0.5897033038914659, 0.589812661135235, 0.5899198579040583, 0.5900248972069542, 0.5901277820529405, 0.5902285154510352, 0.5903271004102566, 0.5904235399396225, 0.5905178370481512, 0.5906099947448604, 0.5907000160387681, 0.5907879039388926, 0.5908736614542522, 0.5909572915938641, 0.591038797366747, 0.5911181817819187, 0.5911954478483972, 0.5912705985752005, 0.5913436369713467, 0.5914145660458539, 0.5914833888077402, 0.5915501082660235, 0.5916147274297217, 0.5916772493078528, 0.5917376769094354, 0.5917960132434867, 0.5918522613190254, 0.5919064241450691, 0.5919585047306362, 0.5920085060847444, 0.592056431216412, 0.592102283134657, 0.5921460648484971, 0.5921877793669506, 0.5922274296990355, 0.5922650188537697, 0.5923005498401717, 0.5923340256672589, 0.5923654493440496, 0.5923948238795618, 0.5924221522828137, 0.5924474375628233, 0.5924706827286081, 0.5924918907891872, 0.5925110647535776, 0.5925282076307978, 0.5925433224298655, 0.5925564121597993, 0.5925674798296168, 0.5925765284483362, 0.5925835610249754, 0.5925885805685525, 0.5925915900880856, 0.5925925925925926, 0.5925915910910915, 0.5925885885926006, 0.5925835881061376, 0.5925765926407209, 0.5925676052053681, 0.5925566288090975, 0.5925436664609272, 0.5925287211698747, 0.5925117959449588, 0.5924928937951972, 0.5924720177296077, 0.5924491707572084, 0.5924243558870177, 0.5923975761280533, 0.5923688344893334, 0.5923381339798759, 0.5923054776086989, 0.5922708683848203, 0.5922343093172582, 0.5921958034150305, 0.5921553536871558, 0.5921129631426514, 0.592068634790536, 0.592022371639827, 0.5919741766995428, 0.5919240529787013, 0.5918720034863205, 0.5918180312314185, 0.5917621392230137, 0.5917043304701233, 0.5916446079817659, 0.5915829747669596, 0.591519433834722, 0.5914539881940717, 0.5913866408540263, 0.5913173948236037, 0.5912462531118223, 0.5911732187277001, 0.591098294680255, 0.5910214839785051, 0.5909427896314683, 0.5908622146481628, 0.5907797620376065, 0.5906954348088174, 0.5906092359708137, 0.5905211685326133, 0.5904312355032344, 0.590339439891695, 0.5902457847070128, 0.590150272958206, 0.5900529076542929, 0.5899536918042911, 0.589852628417219, 0.5897497205020945, 0.5896449710679355, 0.5895383831237604, 0.5894299596785868, 0.5893197037414328, 0.5892076183213166, 0.5890937064272561, 0.5889779710682694, 0.5888604152533747, 0.5887410419915897, 0.5886198542919328, 0.5884968551634218, 0.5883720476150744, 0.5882454346559092, 0.5881170192949441, 0.5879868045411967, 0.5878547934036855, 0.5877209888914285, 0.5875853940134437, 0.5874480117787491, 0.5873088451963624, 0.5871678972753019, 0.5870251710245858, 0.5868806694532319, 0.5867343955702583, 0.5865863523846833, 0.5864365429055244, 0.5862849701418, 0.5861316371025278, 0.5859765467967263, 0.5858197022334132, 0.5856611064216066, 0.5855007623703246, 0.5853386730885852, 0.5851748415854062, 0.5850092708698061, 0.5848419639508025, 0.5846729238374136, 0.5845021535386575, 0.5843296560635521, 0.5841554344211154, 0.5839794916203657, 0.5838018306703209, 0.5836224545799986, 0.5834413663584175, 0.5832585690145953, 0.5830740655575501, 0.5828878589962997, 0.5826999523398626, 0.5825103485972563, 0.5823190507774993, 0.5821260618896092, 0.5819313849426043, 0.5817350229455026, 0.5815369789073221, 0.581337255837081, 0.581135856743797, 0.5809327846364883, 0.5807280425241731, 0.5805216334158689, 0.5803135603205943, 0.5801038262473671, 0.5798924342052054, 0.5796793872031271, 0.5794646882501503, 0.5792483403552932, 0.5790303465275735, 0.5788107097760093, 0.578589433109619, 0.5783665195374202, 0.5781419720684311, 0.5779157937116696, 0.577687987476154, 0.5774585563709023, 0.577227503404932, 0.576994831587262, 0.5767605439269096, 0.576524643432893, 0.5762871331142304, 0.5760480159799398, 0.5758072950390394, 0.5755649733005466, 0.5753210537734803, 0.5750755394668576, 0.5748284333896974, 0.5745797385510171, 0.574329457959835, 0.5740775946251693, 0.5738241515560376, 0.5735691317614582, 0.573312538250449, 0.5730543740320284, 0.5727946421152139, 0.5725333455090239, 0.5722704872224763, 0.5720060702645889, 0.5717400976443802, 0.571472572370868, 0.5712034974530704, 0.5709328759000051, 0.5706607107206907, 0.5703870049241446, 0.5701117615193855, 0.5698349835154307, 0.5695566739212988, 0.5692768357460076, 0.5689954719985751, 0.5687125856880195, 0.5684281798233588, 0.5681422574136109, 0.5678548214677938, 0.5675658749949256, 0.5672754210040246, 0.5669834625041082, 0.566690002504195, 0.566395044013303, 0.5660985900404498, 0.5658006435946538, 0.565501207684933, 0.5652002853203052, 0.5648978795097886, 0.5645939932624015, 0.5642886295871614, 0.5639817914930865, 0.5636734819891951, 0.5633637040845049, 0.5630524607880342, 0.5627397551088009, 0.5624255900558229, 0.5621099686381185, 0.5617928938647054, 0.5614743687446019, 0.561154396286826, 0.5608329795003957, 0.560510121394329, 0.5601858249776437, 0.5598600932593584, 0.5595329292484907, 0.5592043359540586, 0.5588743163850804, 0.5585428735505739, 0.5582100104595572, 0.5578757301210486, 0.5575400355440656, 0.5572029297376266, 0.5568644157107495, 0.5565244964724525, 0.5561831750317534, 0.5558404543976702, 0.5554963375792212, 0.5551508275854242, 0.5548039274252975, 0.554455640107859, 0.5541059686421265, 0.5537549160371181, 0.5534024853018521, 0.5530486794453463, 0.5526935014766191, 0.5523369544046877, 0.551979041238571, 0.5516197649872866, 0.5512591286598527, 0.5508971352652874, 0.5505337878126082, 0.5501690893108337, 0.5498030427689816, 0.5494356511960702, 0.5490669176011176, 0.5486968449931413, 0.5483254363811598, 0.547952694774191, 0.5475786231812528, 0.5472032246113636, 0.546826502073541, 0.5464484585768031, 0.5460690971301683, 0.5456884207426541, 0.545306432423279, 0.5449231351810607, 0.5445385320250176, 0.5441526259641672]
    raw_data = pd.DataFrame(list(zip(x, y)), 
                columns =['x', 'y']) 


    esM.add(fn.ConversionFancy(esM=esM, name='AEC', physicalUnit=r'MW$_{el}$',
                        commodityConversionFactors={'electricity':-1, 'hydrogen':0.64},
                        commodityConversionFactorsPartLoad={'electricity':-1, 'hydrogen': raw_data, },
                        nSegments=3,
                        hasCapacityVariable=True, 
                        bigM=99,
                        investPerCapacity=1300, opexPerCapacity=18, interestRate=0.08, # for 2018 CAPEX
                        economicLifetime=9))


    # AEC with lambda function for commodityConversionFactors
    # esM.add(fn.ConversionFancy(esM=esM, name='AEC', physicalUnit=r'MW$_{el}$',
    #                       commodityConversionFactors={'electricity':-1, 'hydrogen':0.64},
    #                       commodityConversionFactorsPartLoad={'electricity':-1, 'hydrogen': lambda x: 0.5*(x-2)**3 + (x-2)**2},
    #                       nSegments=6,
    #                       hasCapacityVariable=True, 
    #                       bigM=99,
    #                       investPerCapacity=1300, opexPerCapacity=18, interestRate=0.08, # for 2018 CAPEX
    #                       economicLifetime=9))

    # ## Add storage components

    esM.add(fn.Storage(esM=esM, name='Hydrogen tank (gaseous)', commodity='hydrogen',
                    hasCapacityVariable=True, capacityVariableDomain='continuous',
                    capacityPerPlantUnit=1,
                    chargeRate=1, dischargeRate=1, sharedPotentialID=None,
                    stateOfChargeMin=0.06, stateOfChargeMax=1,
                    investPerCapacity=0.004, opexPerCapacity=0.004*0.02, interestRate=0.08,
                    economicLifetime=20))


    # ### Industrial hydrogen demand

    operationRateFix = pd.DataFrame(2*np.ones(numberOfTimeSteps)*(hoursPerTimeStep), columns=['industry_0']) # constant hydrogen demand of 2 MW_GH2: ATTN
    esM.add(fn.Sink(esM=esM, name='Hydrogen demand', commodity='hydrogen', hasCapacityVariable=False,
                    operationRateFix=operationRateFix))


    # # Optimize energy system model

    # Time Series Clustering
    # esM.cluster(numberOfTypicalPeriods=numberOfTypicalPeriods,numberOfTimeStepsPerPeriod=numberOfTimeStepsPerPeriod)

    # Input parameters
    timeSeriesAggregation=False
    solver='glpk'

    # Optimize
    esM.optimize(timeSeriesAggregation=timeSeriesAggregation, solver=solver)

    # # Postprocessing

    # Print the discretization variables of the AEC
    # testresults = esM.componentModelingDict["ConversionFancyModel"].discretizationPointVariablesOptimun
    # print(testresults)

    # Write results to excel file
    #fn.writeOptimizationOutputToExcel(esM, outputFileName='scenarioOutput_industrialSite')

if __name__ == "__main__":
    test_industrialSite()